# üöó Backend Auto Signal

Backend API –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Auto Signal –Ω–∞ Express.js, TypeScript –∏ PostgreSQL —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Prisma ORM.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–ø–∏—Å–∞–Ω–∏–µ](#-–æ–ø–∏—Å–∞–Ω–∏–µ)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞](#-–∑–∞–ø—É—Å–∫-–ø—Ä–æ–µ–∫—Ç–∞)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#-api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [–°–∫—Ä–∏–ø—Ç—ã](#-—Å–∫—Ä–∏–ø—Ç—ã)
- [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

---

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

Backend API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å:
- üë• **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- üöó **–ê–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏** - –º–∞—Ä–∫–∏, –º–æ–¥–µ–ª–∏, –≥–æ–¥—ã –≤—ã–ø—É—Å–∫–∞ (CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏)
- üìÅ **–§–∞–π–ª–∞–º–∏** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ –∏ PDF —Ñ–∞–π–ª–∞–º–∏ (–æ–±—ã—á–Ω—ã–µ –∏ –ø—Ä–µ–º–∏—É–º)
- üíé **–ü–æ–¥–ø–∏—Å–∫–∞–º–∏** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏ —Ü–µ–Ω–∞–º–∏
- üëë **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞

---

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Node.js** –≤–µ—Ä—Å–∏–∏ 18.x –∏–ª–∏ –≤—ã—à–µ
- **PostgreSQL** –≤–µ—Ä—Å–∏–∏ 12.x –∏–ª–∏ –≤—ã—à–µ
- **npm** –∏–ª–∏ **yarn**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π

```bash
node --version   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å v18.x –∏–ª–∏ –≤—ã—à–µ
npm --version    # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 9.x –∏–ª–∏ –≤—ã—à–µ
psql --version   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å PostgreSQL 12.x –∏–ª–∏ –≤—ã—à–µ
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env: DATABASE_URL –∏ JWT_SECRET

# 3. –°–æ–∑–¥–∞–Ω–∏–µ –ë–î PostgreSQL
psql -U postgres -c "CREATE DATABASE auto_signal;"

# 4. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –∏–∑ –¥–∞–º–ø–∞
npm run restore-db-node

# 5. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–î (–í–ê–ñ–ù–û!)
npm run setup-db

# 6. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Prisma
npm run sync-prisma

# 7. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
npm run dev
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000`

### –ö—Ä–∞—Ç–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ (–≤—Å—ë —Å—Ä–∞–∑—É)

```bash
npm install && npm run restore-db-node && npm run setup-db && npm run sync-prisma && npm run dev
```

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd backend-auto-signal
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

#### Windows

1. –°–∫–∞—á–∞–π—Ç–µ PostgreSQL —Å [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞](https://www.postgresql.org/download/windows/)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –∑–∞–ø–æ–º–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `postgres`
3. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```sql
CREATE DATABASE auto_signal;
```

#### Linux/macOS

```bash
# Ubuntu/Debian
sudo apt-get update && sudo apt-get install postgresql postgresql-contrib

# macOS (Homebrew)
brew install postgresql && brew services start postgresql

# –°–æ–∑–¥–∞–Ω–∏–µ –ë–î
sudo -u postgres psql -c "CREATE DATABASE auto_signal;"
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
DATABASE_URL="postgresql://postgres:YOUR_PASSWORD@localhost:5432/auto_signal?schema=public"

# JWT —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ!)
JWT_SECRET="your-super-secret-jwt-key-change-this"

# –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞
PORT=8000

# Telegram Bot Token (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TELEGRAM_BOT_TOKEN=""
```

### 4. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –¥–∞–º–ø–∞
npm run restore-db-node
```

### 5. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

‚ö†Ô∏è **–í–∞–∂–Ω–æ!** –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–º–ø–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
npm run setup-db
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç/–¥–æ–±–∞–≤–ª—è–µ—Ç PRIMARY KEY
- –î–æ–±–∞–≤–ª—è–µ—Ç UNIQUE constraints
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç sequences –¥–ª—è auto-increment

### 6. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Prisma

```bash
npm run sync-prisma
```

---

## üèÉ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
npm run dev
```

### Production —Ä–µ–∂–∏–º

```bash
npm run build
npm start
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

- **API:** `http://localhost:8000`
- **Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `http://localhost:8000/api-docs`
- **Debug –º–∞—Ä—à—Ä—É—Ç—ã:** `http://localhost:8000/debug/routes`

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit-—Ç–µ—Å—Ç—ã (Jest)

```bash
npm test
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)

```bash
npm run test-backend
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
npm run check-db
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend-auto-signal/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Swagger)
‚îÇ   ‚îú‚îÄ‚îÄ controllers/     # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adminController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ carsController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filesController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ infoController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ subscriptionController.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usersController.js
‚îÇ   ‚îú‚îÄ‚îÄ middleware/      # Middleware (auth, admin)
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # –ú–∞—Ä—à—Ä—É—Ç—ã Express
‚îÇ   ‚îú‚îÄ‚îÄ tests/           # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ index.ts         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ migrations/      # –ú–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma    # –°—Ö–µ–º–∞ Prisma
‚îú‚îÄ‚îÄ check-database.js    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
‚îú‚îÄ‚îÄ setup-database.js    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–î –ø–æ—Å–ª–µ –¥–∞–º–ø–∞
‚îú‚îÄ‚îÄ restore-database-node.js  # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î
‚îú‚îÄ‚îÄ sync-prisma.js       # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Prisma
‚îú‚îÄ‚îÄ test-backend.js      # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
‚îî‚îÄ‚îÄ README.md
```

---

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### Swagger UI

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: `http://localhost:8000/api-docs`

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `POST /api/users/login` - –í—Ö–æ–¥/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/users/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `GET /api/users/me` - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

#### üöó –ê–≤—Ç–æ–º–æ–±–∏–ª–∏
- `GET /api/cars/brands` - –í—Å–µ –º–∞—Ä–∫–∏
- `GET /api/cars/models?brandId=X` - –ú–æ–¥–µ–ª–∏ –ø–æ –º–∞—Ä–∫–µ
- `GET /api/cars/years?modelId=X` - –ì–æ–¥—ã –ø–æ –º–æ–¥–µ–ª–∏

#### üìÅ –§–∞–π–ª—ã
- `GET /api/files/years/:yearId/files?userId=X` - –§–∞–π–ª—ã –ø–æ –≥–æ–¥—É

#### üíé –ü–æ–¥–ø–∏—Å–∫–∏
- `GET /api/subscription/prices` - –¶–µ–Ω—ã –ø–æ–¥–ø–∏—Å–æ–∫
- `GET /api/subscription/user/:userId` - –ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- `GET /api/admin/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/admin/admins/list` - –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

```
Authorization: Bearer <your_jwt_token>
```

---

## üõ†Ô∏è –°–∫—Ä–∏–ø—Ç—ã

| –°–∫—Ä–∏–ø—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `npm run dev` | –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| `npm run build` | –°–±–æ—Ä–∫–∞ TypeScript |
| `npm start` | –ó–∞–ø—É—Å–∫ production |
| `npm test` | –ó–∞–ø—É—Å–∫ Jest —Ç–µ—Å—Ç–æ–≤ |
| `npm run test-backend` | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API |
| `npm run check-db` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `npm run restore-db-node` | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –∏–∑ –¥–∞–º–ø–∞ |
| `npm run setup-db` | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–î (–ø–æ—Å–ª–µ –¥–∞–º–ø–∞) |
| `npm run sync-prisma` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Prisma |

---

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DATABASE_URL` –≤ `.env`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `npm run check-db`

### –û—à–∏–±–∫–∞ "Cannot read properties of undefined"

–°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ë–î –Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
npm run setup-db
npm run sync-prisma
```

### –û—à–∏–±–∫–∞ "Null constraint violation on id"

Sequences –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
npm run setup-db
```

### –ü–æ—Ä—Ç 8000 –∑–∞–Ω—è—Ç

–ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ `.env`:

```env
PORT=8001
```

---

## üìù –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Express.js** 5.x
- **TypeScript** 5.x
- **PostgreSQL**
- **Prisma** 6.x
- **JWT**
- **Jest**
- **Swagger**

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

ISC
